(()=>{"use strict";class s{constructor(s,t){this.x=s,this.y=t}static get ZERO(){return new s(0,0)}static get UNIT(){return new s(i,i)}round(){return new s(Math.round(this.x),Math.round(this.y))}}const t=new s(.05,.1),i=32,e={"":16,u:15,d:13,l:12,r:10,ud:14,lr:11,ul:9,ur:7,dl:3,dr:1,udl:6,udr:4,ulr:8,dlr:2,udlr:5};class h{constructor(s,t,i){this.sprite=new Image,this.pos=s,this.size=t,this.sprite.src=i}draw(s,t){s.drawImage(this.sprite,this.pos.x-this.size.x/2-t.x,this.pos.y-this.size.y/2-t.y)}getPosition(){return this.pos}get bounds(){return{left:this.pos.x-this.size.x/2,right:this.pos.x+this.size.x/2,top:this.pos.y-this.size.y/2,bottom:this.pos.y+this.size.y/2}}static getFrame(s,t){return Math.floor(Date.now()%(s*t)/s)}}class o extends h{constructor(t){super(t,s.UNIT,"assets/coin/0.png"),this.og=t.y}tick(){this.pos.y=this.og+2*Math.sin(.01*Date.now()),this.sprite.src=`assets/coin/${h.getFrame(100,6)}.png`}}class n extends h{constructor(t){super(t,new s(i,.75*i),"assets/lava/0.png")}tick(){this.sprite.src=`assets/lava/${h.getFrame(500,2)}.png`}}class r extends h{constructor(t,i){super(t,s.UNIT,"assets/links/0.png"),this.og=t.y,this.url=i}tick(){this.pos.y=this.og+2*Math.sin(.01*Date.now())}open(){window.open(this.url)}}class a extends h{constructor(t){super(t,s.UNIT,"assets/mushroom/0.png"),this.last=Date.now()+300*Math.random(),this.frame=0,this.squished=!1,this.og=t.y}tick(){!this.squished&&Date.now()>this.last+300&&(this.frame=0===this.frame?1:0,this.sprite.src=`assets/mushroom/${this.frame}.png`,this.last=Date.now()+300*Math.random())}setSquished(s){this.squished=s,this.sprite.src=`assets/mushroom/${s?2:0}.png`,this.pos.y=s?this.og+.1875*i:this.og}}class c extends h{constructor(t,i){super(t,s.UNIT,`assets/platforms/${i}.png`)}}class l extends h{constructor(t){super(Object.assign({},t),new s(i/2,i),"assets/neo/0.png"),this.vel=s.ZERO,this.grounded=!1,this.flip=!1,this.dead=!1,this.prev={mushroom:null,link:null},this.start=t}reset(){this.dead=!0,setTimeout((()=>{this.dead=!1,this.respawn()}),1500)}respawn(){this.pos=Object.assign({},this.start),this.vel=s.ZERO,this.flip=!1}move(s,t){s&&(this.vel.x-=.5),t&&(this.vel.x+=.5)}jump(){this.grounded&&(this.vel.y=10)}tick(s,t){this.pos.x+=this.vel.x;for(const t of s.checkpoints)if(this.checkCollision(t)){this.start=t.getPosition();for(const t of s.checkpoints)t.setActive(!1);t.setActive(!0)}for(const t of s.platforms)this.checkCollision(t)&&(this.pos.x-=this.vel.x>0?this.bounds.right-t.bounds.left:this.bounds.left-t.bounds.right,this.vel.x=0);this.pos.y-=this.vel.y,this.grounded=!1;for(const t of s.platforms)this.checkCollision(t)&&(this.pos.y-=this.vel.y>0?this.bounds.top-t.bounds.bottom:this.bounds.bottom-t.bounds.top,this.vel.y=0,this.grounded=this.pos.y<t.getPosition().y);for(const t of s.coins)this.checkCollision(t)&&s.coins.splice(s.coins.indexOf(t),1);for(const t of s.lavas)if(this.checkCollision(t))return"reset";for(const t of s.mushrooms)this.checkCollision(t)&&this.prev.mushroom!==t?(t.setSquished(!0),setTimeout((()=>{this.checkCollision(t)&&(this.vel.y=15),t.setSquished(!1)}),500),this.prev.mushroom=t):this.checkCollision(t)||this.prev.mushroom!==t||(this.prev.mushroom=null);for(const t of s.links)this.checkCollision(t)&&this.prev.link!==t?(t.open(),this.prev.link=t):this.checkCollision(t)||this.prev.link!==t||(this.prev.link=null);return this.vel.x*=.9,this.vel.y-=.5,this.vel.y+.5>0?this.sprite.src="assets/neo/4.png":this.vel.y+.5<0?this.sprite.src="assets/neo/5.png":void(this.sprite.src=`assets/neo/${t?l.FRAMES.moving[h.getFrame(100,4)]:l.FRAMES.idle[h.getFrame(200,2)]}.png`)}draw(s,t){this.dead&&Date.now()%400<200||(this.flip&&s.scale(-1,1),s.drawImage(this.sprite,(this.pos.x+this.size.x*(this.flip?1:-1)-t.x)*(this.flip?-1:1),this.pos.y-this.size.y/2-t.y),this.flip&&s.scale(-1,1))}checkCollision(s){return this.bounds.left<s.bounds.right&&this.bounds.right>s.bounds.left&&this.bounds.top<s.bounds.bottom&&this.bounds.bottom>s.bounds.top}setFlip(s){this.flip=s}get top(){return this.pos.y-this.size.y/2}}l.FRAMES={idle:[0,1],moving:[2,1,3,1]};class p extends h{constructor(t,i){super(t,s.UNIT,"assets/flag/0.png"),this.active=i}tick(){this.sprite.src=`assets/flag/${2*h.getFrame(200,4)+(this.active?0:1)}.png`}setActive(s){this.active=s}}const d=JSON.parse("[[0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,3,3,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,1,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,7],[0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,1,1,1,1,3,3,3,1,3,3,3,1],[0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,2,0,0,6,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1],[0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,2,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,1,0,0,0,1,0,0,0,1,0,0,5,2],[1,1,3,3,3,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]"),u=new class{constructor(){this.run=!1,this.canvas=document.querySelector("canvas"),this.ctx=this.canvas.getContext("2d"),this.keys={left:!1,right:!1,jump:!1},this.cam=new s(-window.innerWidth/2,-window.innerHeight/2),this.player=new l(s.ZERO),this.start=s.ZERO,this.env={platforms:[],coins:[],lavas:[],mushrooms:[],links:[],checkpoints:[]},this.texts=[],this.coins=0,this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,window.addEventListener("resize",(()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight})),document.addEventListener("keydown",(s=>this.handleKey(s,!0))),document.addEventListener("keyup",(s=>this.handleKey(s,!1))),document.addEventListener("touchstart",(s=>{if(!this.player.dead){if(s.touches[0].clientY<.45*this.canvas.height&&(this.keys.jump=!0),s.touches[0].clientX<.3*this.canvas.width)return this.keys.left=!0,this.player.setFlip(!0);s.touches[0].clientX>.7*this.canvas.width&&(this.keys.right=!0,this.player.setFlip(!1))}})),document.addEventListener("touchend",(s=>this.keys={left:!1,right:!1,jump:!1}))}play(s){this.run=s,s&&requestAnimationFrame((()=>this.tick()))}reset(){this.keys={left:!1,right:!1,jump:!1},this.player.reset()}tick(){this.run&&requestAnimationFrame((()=>this.tick())),this.player.top-this.cam.y>this.canvas.height&&this.player.respawn(),this.ctx.fillStyle="#61afef",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(const s of Object.values(this.env))for(const t of s)t.tick&&t.tick(),t.draw(this.ctx,this.cam);for(const s of this.texts)s.draw(this.ctx,this.cam);this.player.draw(this.ctx,this.cam);let s=new Image;if(s.src=`assets/coin/${h.getFrame(100,6)}.png`,this.ctx.drawImage(s,20,20),this.ctx.fillStyle="#282c34",this.ctx.font="24px Cascadia Code",this.ctx.fillText((this.coins-this.env.coins.length).toString(),55,44),this.player.dead)return;this.player.move(this.keys.left,this.keys.right),this.keys.jump&&this.player.jump(),"reset"===this.player.tick(this.env,this.keys.left||this.keys.right)&&this.reset();const i=this.player.getPosition();this.cam.x-=(this.cam.x+this.canvas.width/2-i.x)*t.x,this.cam.y-=(this.cam.y+this.canvas.height/2-i.y)*t.y,this.cam=this.cam.round(),this.cam.y>-400&&(this.cam.y=-400)}loadMap(s){for(let t=0;t<s.length;t++)for(let i=0;i<s[t].length;i++)if(0!==s[t][i])switch(s[t][i]){case 0:continue;case 1:let h="";this.exists(s,t-1,i)&&(h+="u"),this.exists(s,t+1,i)&&(h+="d"),this.exists(s,t,i-1)&&(h+="l"),this.exists(s,t,i+1)&&(h+="r"),this.env.platforms.push(new c(this.fromCoords(t,i,s),e[h]-1));break;case 2:this.env.coins.push(new o(this.fromCoords(t,i,s)));break;case 3:this.env.lavas.push(new n(this.fromCoords(t,i,s)));break;case 4:const d=this.fromCoords(t,i,s);this.player=new l(d),this.cam.x=this.start.x-window.innerWidth/2,this.cam.y=this.start.y-window.innerHeight/2,this.env.checkpoints.push(new p(d,!0));break;case 5:this.env.mushrooms.push(new a(this.fromCoords(t,i,s)));break;case 6:this.env.links.push(new r(this.fromCoords(t,i,s),"https://www.youtube.com/watch?v=dQw4w9WgXcQ"));break;case 7:this.env.checkpoints.push(new p(this.fromCoords(t,i,s),!1))}this.coins=this.env.coins.length}handleKey(s,t){if(!this.player.dead){switch(s.key){default:return;case"ArrowLeft":case"a":this.keys.left=t,t&&this.player.setFlip(!0);break;case"ArrowRight":case"d":this.keys.right=t,t&&this.player.setFlip(!1);break;case"ArrowUp":case"w":case" ":this.keys.jump=t;break;case"p":t&&this.play(!this.run);break;case"o":t&&this.reset()}s.preventDefault()}}fromCoords(t,e,h){return new s((e-(h[t].length-1)/2)*i,(t-(h.length-1)/2)*i)}exists(s,t,i){return t>=0&&i>=0&&t<s.length&&i<s[t].length&&1===s[t][i]}};u.loadMap(d),u.play(!0)})();